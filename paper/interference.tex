\documentclass[12pt]{article}

\usepackage[utf8]{inputenc}
\usepackage[plainruled,noline]{algorithm2e}

\input{macros.tex}

\begin{document}

\section{Register Allocation}

How to compute the \AMi-induced edges of the interference graph.

% A secret-dependent region:
%     - A tuple of (set(basic block), set(dir-edge), entry, exit)
%     - Fully connected
%     - exit block postdominates all blocks
%     - terminator of entry is secret dependent

% - Index(i), Index(bb)
%      defines a total order between instructions and between basic blocks
%         according to some linearization function
%                   (LLVM linearization, *not* AMi linearization)
%
%      the indexes are assigned such that 
%              for all instructions i:
%                 basic-block(i) < i
%
% - Users(R, i)
%       returns all uses of instruction i within region R
% - Instructions(R)
%       returns the instructions of the region R
% - PersistentInstructions(R):
%       returns the persistent instructions of the region R
% - BasicBlock(i)
%       returns the basic block of the instruction i
% - Connected(bb1, bb2)
%        true if path from bb1 to bb2 or if path from bb2 to bb1
%              (bb2 is reachable from bb1 or bb1 is reachable from bb2)

\begin{algorithm}
\Fn{\FComputeAMiInterferenceEdges{$R$}}{
  \DontPrintSemicolon
  \KwData{Secret-dependent region $R$}
  \KwResult{Set of \AMi-induced edges $E$}
  \;
  $E \gets \emptyset$\;
  \For{$p \in \FPersistentInstructions{R}$}{
    \For{$bb \in \FBasicBlocks{R} \mid \neg \FConnected(\FBasicBlock(p), bb)$}{
      \;
      \Comment{Case 1}
      \If{$bb > \FBasicBlock(p)$}{
        \Comment{Case 1.1}
        \For{$i \in \FUsers(R, p)$}{
          \Comment{Bug in \AMi{} tranformation?}
          \Assert{$i < bb$}
        }
        \Comment{Case 1.2}
      }
      \;
      \Comment{Case 2}
      \If{$bb < \FBasicBlock(p)$}{
        \Comment{Case 2.1}
        \Comment{Case 2.2}
      }
    }
  }
  \;
  \Return{$E$}
}
\end{algorithm}

\end{document}
